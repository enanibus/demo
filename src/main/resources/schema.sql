-- Drop tables in correct order (child first, then parents)
DROP TABLE IF EXISTS PRICES;
DROP TABLE IF EXISTS PRODUCTS;
DROP TABLE IF EXISTS BRANDS;

-- Table BRANDS
CREATE TABLE IF NOT EXISTS BRANDS (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    chain_name VARCHAR(255) NOT NULL
);

-- Table PRODUCTS
CREATE TABLE IF NOT EXISTS PRODUCTS (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    product_name VARCHAR(255) NOT NULL
);

-- Table PRICES
CREATE TABLE IF NOT EXISTS PRICES (
    price_list INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    brand_id INT NOT NULL,
    product_id INT NOT NULL,
    start_date TIMESTAMP NOT NULL,
    end_date TIMESTAMP NOT NULL,
    priority INT NOT NULL,
    price DECIMAL(19,2) NOT NULL,
    currency VARCHAR(3) NOT NULL,
    CONSTRAINT fk_prices_brand FOREIGN KEY (brand_id) REFERENCES BRANDS(id),
    CONSTRAINT fk_prices_product FOREIGN KEY (product_id) REFERENCES PRODUCTS(id)
);

CREATE INDEX IF NOT EXISTS idx_prices_brand ON PRICES(brand_id);
CREATE INDEX IF NOT EXISTS idx_prices_product ON PRICES(product_id);
CREATE INDEX IF NOT EXISTS idx_prices_dates ON PRICES(start_date, end_date);

